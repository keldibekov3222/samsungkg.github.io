function TooltipController(e){function s(e){e.data(DATA_HASACTIVEHOVER,!0),u.queue(function(s){o(e),s()})}function o(s){var a;if(s.data(DATA_HASACTIVEHOVER)){if(session.isTipOpen)return session.isClosing||i(session.activeHover),void u.delay(100).queue(function(e){o(s),e()});s.trigger("powerTipPreRender"),a=getTooltipContent(s),a&&(u.empty().append(a),s.trigger("powerTipRender"),session.activeHover=s,session.isTipOpen=!0,u.data(DATA_MOUSEONTOTIP,e.mouseOnToPopup),e.followMouse?n():(t(s),session.isFixedTipOpen=!0),u.addClass(e.popupClass),s.data(DATA_FORCEDOPEN)||$document.on("click"+EVENT_NAMESPACE,function(o){var i=o.target;i!==s[0]&&(e.mouseOnToPopup?i===u[0]||$.contains(u[0],i)||$.powerTip.hide():$.powerTip.hide())}),e.mouseOnToPopup&&!e.manual&&(u.on("mouseenter"+EVENT_NAMESPACE,function(){session.activeHover&&session.activeHover.data(DATA_DISPLAYCONTROLLER).cancel()}),u.on("mouseleave"+EVENT_NAMESPACE,function(){session.activeHover&&session.activeHover.data(DATA_DISPLAYCONTROLLER).hide()})),u.fadeIn(e.fadeInTime,function(){session.desyncTimeout||(session.desyncTimeout=setInterval(r,500)),s.trigger("powerTipOpen")}))}}function i(s){session.isClosing=!0,session.isTipOpen=!1,session.desyncTimeout=clearInterval(session.desyncTimeout),s.data(DATA_HASACTIVEHOVER,!1),s.data(DATA_FORCEDOPEN,!1),$document.off("click"+EVENT_NAMESPACE),u.off(EVENT_NAMESPACE),u.fadeOut(e.fadeOutTime,function(){var o=new CSSCoordinates;session.activeHover=null,session.isClosing=!1,session.isFixedTipOpen=!1,u.removeClass(),o.set("top",session.currentY+e.offset),o.set("left",session.currentX+e.offset),u.css(o),s.trigger("powerTipClose")})}function n(){if(!session.isFixedTipOpen&&(session.isTipOpen||session.tipOpenImminent&&u.data(DATA_HASMOUSEMOVE))){var s,o,i=u.outerWidth(),n=u.outerHeight(),t=new CSSCoordinates;t.set("top",session.currentY+e.offset),t.set("left",session.currentX+e.offset),s=getViewportCollisions(t,i,n),s!==Collision.none&&(o=countFlags(s),1===o?s===Collision.right?t.set("left",session.windowWidth-i):s===Collision.bottom&&t.set("top",session.scrollTop+session.windowHeight-n):(t.set("left",session.currentX-i-e.offset),t.set("top",session.currentY-n-e.offset))),u.css(t)}}function t(s){var o,i;e.smartPlacement?(o=$.fn.powerTip.smartPlacementLists[e.placement],$.each(o,function(e,o){var n=getViewportCollisions(a(s,o),u.outerWidth(),u.outerHeight());return i=o,n===Collision.none?!1:void 0})):(a(s,e.placement),i=e.placement),u.removeClass("w nw sw e ne se n s w se-alt sw-alt ne-alt nw-alt"),u.addClass(i)}function a(s,o){var i,n,t=0,a=new CSSCoordinates;a.set("top",0),a.set("left",0),u.css(a);do i=u.outerWidth(),n=u.outerHeight(),a=l.compute(s,o,i,n,e.offset),u.css(a);while(++t<=5&&(i!==u.outerWidth()||n!==u.outerHeight()));return a}function r(){var s=!1;session.isTipOpen&&!session.isClosing&&!session.delayInProgress&&($.inArray("mouseleave",e.closeEvents)>-1||$.inArray("mouseout",e.closeEvents)>-1||$.inArray("blur",e.closeEvents)>-1||$.inArray("focusout",e.closeEvents)>-1)&&(session.activeHover.data(DATA_HASACTIVEHOVER)===!1||session.activeHover.is(":disabled")?s=!0:isMouseOver(session.activeHover)||session.activeHover.is(":focus")||session.activeHover.data(DATA_FORCEDOPEN)||(u.data(DATA_MOUSEONTOTIP)?isMouseOver(u)||(s=!0):s=!0),s&&i(session.activeHover))}var l=new PlacementCalculator,u=$("#"+e.popupId);0===u.length&&(u=$("<div/>",{id:e.popupId}),0===$body.length&&($body=$("body")),$body.append(u),session.tooltips=session.tooltips?session.tooltips.add(u):u),e.followMouse&&(u.data(DATA_HASMOUSEMOVE)||($document.on("mousemove"+EVENT_NAMESPACE,n),$window.on("scroll"+EVENT_NAMESPACE,n),u.data(DATA_HASMOUSEMOVE,!0))),this.showTip=s,this.hideTip=i,this.resetPosition=t}